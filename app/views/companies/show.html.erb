<div class='page-header container-fluid company-show-header'>
  <div class='company-show-logo'>
    <% if @company.logo_url.file == nil %>
        <img src="https://via.placeholder.com/120" class="logo">
      <% else %>
      <p> <%= cl_image_tag @company.logo_url, height: 120, width: 220, crop: :fit %></p>
    <% end %>

  </div>
  <div>
    <h3><strong><%= @company.name %></strong> </h3>
  </div>

  <div class='company-show-infos'>
    <div class='home-card' id='company-info-card'>


      <div class='home-card-body'>
        <p> <strong>Forme sociale</strong> : <%= @company.legal_form %> </p>
        <p> <strong>Siège social</strong> :  <%= @company.address %></p>
        <%= link_to edit_company_path(@company.id) do %>
          <i class="far fa-edit" id='edit-company-info'>Complétez les informations</i>
        <% end %>
      </div>

    </div>

  </div>

</div>

<div class='operation-step-description'>
   <h4>Les étapes de votre levée de fonds :</h4>
  <div class="container-fluid progressbar-container">
    <ul class="progressbar">
        <li >Renseignez les informations relatives à votre capital</li>
        <li class="active">Créez une nouvelle opération</li>
        <li>Créez un nouvelle opération</li>
        <li>Passez aux signatures !</li>
    </ul>
  </div>
</div>


</div>


<div class='container-fluid page-content'>

  <div class='row'>

    <div class ='col col-xs-12'>

      <div class='home-card'>

        <div class = 'home-card-header'>
          <h3>Répartition du capital</h3>
        </div>

        <div class="home-card-body">
          <div class="captable-card-list">
            <ul>
              <% @shareholders.each do |id, shares| %>
                <li>
                  <div class="captable-list">
                    <div class="captable-list-name">
                      <%= User.find(id).last_name %> <%= User.find(id).first_name %>
                    </div>
                    <div class="captable-list-shares">
                      <%= money_without_cents shares %> actions
                    </div>
                    <div class="captable-list-shares-pourcent">
                      <%= ( (shares.to_f / @company.number_of_shares.to_f).round(2) * 100).round(0) %> %
                    </div>
                  </div>
                </li>
              <% end %>
              <li>Total : <%= money_without_cents @company.number_of_shares %> actions</li>
            </ul>
          </div>
          <% if @company.operations.where(category: 'initialize-captable').empty? %>
            <%= link_to new_company_captable_path(@company.id) do %>
              <button style="button" class="btn-transparent-small">Initialiser le capital</button>
            <% end %>
          <% else %>
            <%= link_to new_company_captable_path(@company.id) do %>
              <button style="button" class="btn-transparent-small">Editer</button>
            <% end %>
          <% end %>
        </div>

      </div>
    </div>

        <div class = 'home-card-header'>
          <h3>Informations</h3>
        </div>

        <div class = "home-card-avatar">
          <% if @company.logo_url.file == nil %>
              <img src="https://via.placeholder.com/120" class="logo">
            <% else %>
            <p> <%= cl_image_tag @company.logo_url, height: 120, width: 220, crop: :fit %></p>
          <% end %>
        </div>

        <div class='home-card-body'>
          <p> <strong>Nom</strong> :  <%= @company.name %> </p>
          <p> <strong>Forme sociale</strong> : <%= @company.legal_form %> </p>
          <p> <strong>Siège social</strong> :  <%= @company.address %></p>
          <div class='home-card-footer'>
            <%= link_to edit_company_path(@company.id) do %>
              <button style="button" class="btn-transparent-small">Compléter les informations</button>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class='row'>
    <div class = 'col col-xs-11'>
      <div class = 'home-card-header'>
        <h3>Opérations</h3>
      </div>
      <div class = "home-card-body">
        <ul>
          <% @company.operations.each do |operation| %>
            <% unless operation.category == 'initialize-captable' %>
              <li>
                <div class="operation-list">
                  <div class="operation-list-category">
                    <div>
                      <span>Catégorie</span>
                    </div>
                    <div>
                      <h5><%= operation.category %></h5>
                    </div>
                  </div>
                  <div class="operation-list-amount">
                    <% if operation. status == 'completed' %>
                      <div>
                        <span>Montant de l'opération</span>
                      </div>
                      <div>
                        <h5><strong><%= money_without_cents operation.target_amount %> euros</strong></h5>
                      </div>
                    <% else %>
                      <div>
                        <span>Montant visé</span>
                      </div>
                      <div>
                        <h5><strong><%= money_without_cents operation.target_amount %> euros</strong></h5>
                      </div>
                    <% end %>
                  </div>
                  <div class="operation-list-closing-date">
                    <% if operation. status == 'completed' %>
                      <div>
                        <span>Date de réalisation</span>
                      </div>
                      <div>
                        <h5><%= operation.expected_closing_date %></h5>
                      </div>
                    <% else %>
                      <div>
                        <span>Date de réalisation estimée</span>
                      </div>
                      <div>
                        <h5><%= operation.expected_closing_date %></h5>
                      </div>
                    <% end %>
                  </div>
                  <div class="operation-list-status">
                    <% if operation. status == 'completed' %>
                      <div>
                        <span>Status</span>
                      </div>
                      <div>
                        <h5><strong>Finalisée</strong></h5>
                      </div>
                    <% else %>
                      <div>
                        <span>Status</span>
                      </div>
                      <div>
                        <h5><strong>En cours</strong></h5>
                      </div>
                    <% end %>
                  </div>
                  <div class="operation-list-link">
                    <%= link_to operation_path(operation) do %>
                      <button style="button" class="btn-transparent-small">Détails</button>
                    <% end %>
                  </div>
                </div>
              </li>
            <% end %>
          <% end %>
        </ul>
      <div class="text-align-center">
        <%= link_to new_company_operation_path(@company) do %>
          <button style="button" class="btn btn-form-action">Ajouter une opération</button>
        <% end %>
      </div>
    </div>
  </div>
</div>









